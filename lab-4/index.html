<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Лабораторная работа #4 - Web-программирвоание</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u041b\u0430\u0431\u043e\u0440\u0430\u0442\u043e\u0440\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430 #4";
        var mkdocs_page_input_path = "lab-4.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Web-программирвоание
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Главная</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lab-1/">Лабораторная работа #1</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lab-2/">Лабораторная работа #2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../lab-3/">Лабораторная работа #3</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Лабораторная работа #4</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#_1">Задание</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_2">Реализация</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#mainjs">main.js</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#storesindexjs">stores/index.js</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#apiindexjs">api/index.js</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewsloginviewvue">views/LoginView.vue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewssignupviewvue">views/SignupView.vue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewslistingsviewvue">views/ListingsView.vue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewlistingdetailviewvue">view/ListingDetailView.vue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewscommentsviewvue">views/CommentsView.vue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewsnewcommentviewvue">views/NewCommentView.vue</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#viewsnewlistingviewvue">views/NewListingView.vue</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pract-3-1/">Практическая работа #3.1</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Web-программирвоание</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Лабораторная работа #4</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="4">Лабораторная работа #4</h1>
<h2 id="_1">Задание</h2>
<p>Реализация клиентской части приложения средствами vue.js.</p>
<h2 id="_2">Реализация</h2>
<h3 id="mainjs">main.js</h3>
<p>Создадим наше приложение, подключив к нему роутер и pinia для state management.</p>
<pre><code class="language-js">import './assets/main.css'
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'
import router from './router'

const app = createApp(App)

app.use(createPinia())
app.use(router)

app.mount('#app')

</code></pre>
<h3 id="storesindexjs">stores/index.js</h3>
<p>Создадим глобальное хранилище для пользовательских данных. Нам они понадобятся для реализации входа, регистрации и профиля пользователя.</p>
<p>Для данной лабораторной работы нам понадобится хранение и получение пароля, имени пользователя и электронной почты.</p>
<pre><code class="language-js">import { defineStore } from 'pinia'

export const useAuthStore = defineStore('auth', {
    state: () =&gt; ({ password: localStorage.getItem(&quot;password&quot;), username: localStorage.getItem(&quot;username&quot;), token: localStorage.getItem(&quot;auth_token&quot;) }),
    getters: {
        userData: (state) =&gt; state
    },
    actions: {
        login(username, password, token) {
            this.username = username
            this.password = password
            this.token = token
            localStorage.setItem(&quot;auth_token&quot;, token)
            localStorage.setItem(&quot;username&quot;, username)
            localStorage.setItem(&quot;password&quot;, password)
        },
        logout() {
            this.username = ''
            this.password = ''
            this.token = ''
            localStorage.removeItem(&quot;auth_token&quot;)
            localStorage.removeItem(&quot;username&quot;)
            localStorage.removeItem(&quot;password&quot;)
        },
    }
})
</code></pre>
<h3 id="apiindexjs">api/index.js</h3>
<p>Для нашего бекенда, который использует авторизацию с помощью токенов, нам нужно создать функцию, которая будет добавлять заголовок Authorization с токеном пользователя перед отправкой HTTP запроса. Мы решили использовать библиотеку axios для выполнения HTTP запросов в этой лабораторной работе.</p>
<h3 id="viewsloginviewvue">views/LoginView.vue</h3>
<p>Реализуем необходимый метод входа в предсталвении страницы логина, который делает post-запрос на API.</p>
<pre><code class="language-js">&lt;script&gt;
import api from '../api'
import router from '../router'
import { useAuthStore } from '../stores/auth'

export default {
    data() {
        this.authStore = useAuthStore()
        return {
            loginData: {
                email: '',
                username: '',
                password: '',
            },
        }
    },
    methods: {
        login() {
        api
            .post('auth/token/login', {
                username: this.loginData.username,
                password: this.loginData.password,
            })
            .then((resp) =&gt; resp.data)
            .then((data) =&gt; {
                this.authStore.login(
                    this.loginData.username,
                    this.loginData.password,
                    data.auth_token
                )
                router.push({ path: '/listings' })
            })
        },
    },
}
&lt;/script&gt;

&lt;template&gt;
    &lt;div&gt;
        &lt;div class=&quot;login&quot;&gt;
        &lt;h3&gt;Login&lt;/h3&gt;
        &lt;label for=&quot;username&quot;&gt;Username&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;username&quot; v-model=&quot;loginData.username&quot; /&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;label for=&quot;password&quot;&gt;Password&lt;/label&gt;
        &lt;input type=&quot;password&quot; name=&quot;password&quot; v-model=&quot;loginData.password&quot; /&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;button v-on:click=&quot;login&quot;&gt;Login&lt;/button&gt;
    &lt;/div&gt;
&lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 id="viewssignupviewvue">views/SignupView.vue</h3>
<p>Реализуем необходимый метод регистрации в предсталвении страницы, который делает post-запрос на API.</p>
<pre><code class="language-js">&lt;script&gt;
import api from '../api'
import router from '../router'
import { useAuthStore } from '../stores/auth'

export default {
    data() {
        this.authStore = useAuthStore()
        return {
            signupData: {
                email: '',
                username: '',
                password: '',
            },
        }
    },
    methods: {
        signup() {
        api
            .post('api/users/', {
                email: this.signupData.email,
                username: this.signupData.username,
                password: this.signupData.password,
            })
            .then((resp) =&gt; resp.data)
            .then((data) =&gt; {
                this.authStore.login(
                    this.signupData.username,
                    this.signupData.password,
                    data.auth_token
                )
                router.push({ path: '/listings' })
            })
        },
    },
}

&lt;/script&gt;

&lt;template&gt;
    &lt;div class=&quot;signup&quot;&gt;
        &lt;h3&gt;Sign Up&lt;/h3&gt;
        &lt;label for=&quot;email&quot;&gt;Email&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;email&quot; v-model=&quot;signupData.email&quot; /&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;label for=&quot;username&quot;&gt;Username&lt;/label&gt;
        &lt;input type=&quot;text&quot; name=&quot;username&quot; v-model=&quot;signupData.username&quot; /&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;label for=&quot;password&quot;&gt;Password&lt;/label&gt;
        &lt;input type=&quot;password&quot; name=&quot;password&quot; v-model=&quot;signupData.password&quot; /&gt;
        &lt;br /&gt;
        &lt;br /&gt;
        &lt;button v-on:click=&quot;signup&quot;&gt;Sign Up&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 id="viewslistingsviewvue">views/ListingsView.vue</h3>
<p>Данное предсталвение является первым экраном, что видит пользователь после входа в свою учетную запись в данном приложении.</p>
<pre><code class="language-js">&lt;script&gt;
import api from '../api'
import Listing from '../components/Listing.vue'
import router from '../router'

export default {
    data() {
        return { listings: [] }
    },
    components: {
        Listing,
    },
    methods: {
        getListings() {
        api
            .get('api/listings/')
            .then((resp) =&gt; resp.data)
            .then((data) =&gt; (this.listings = data))
            .catch(() =&gt; alert('Failed to fetch listings'))
        },
        newListing() {
            router.push({ path: '/listings/new' })
        },
    },
    beforeMount() {
        this.getListings()
    },
}
&lt;/script&gt;

&lt;template&gt;
    &lt;br /&gt;
    &lt;button @click=&quot;newListing&quot;&gt;New listing&lt;/button&gt;
    &lt;div class=&quot;listings&quot;&gt;
        &lt;Listing v-for=&quot;listing in listings&quot; :listing=&quot;listing&quot; :key=&quot;listing.id&quot; /&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 id="viewlistingdetailviewvue">view/ListingDetailView.vue</h3>
<p>Данное представление ялвяется развернутой странице с полной информацией о листинге, включая комментарии, последнюю ставку.</p>
<pre><code class="language-js">&lt;script&gt;
import api from '../api'
import { useAuthStore } from '../stores/auth'
import CommentsView from './CommentsView.vue'

export default {
    data() {
        this.authStore = useAuthStore();
        return { listing: { id: this.$route.params.id, title: '', description: '' }, bids: [] };
    },
    beforeMount() {
        api
            .get(`api/listings/${this.listing.id}`)
            .then((resp) =&gt; resp.data)
            .then((data) =&gt; (this.listing = data))
            .catch((_) =&gt; alert('Failed to fetch listing'));

        api
            .get(`api/listings/${this.listing.id}/bids`)
            .then((resp) =&gt; resp.data)
            .then((data) =&gt; (this.bids = data))
            .catch((_) =&gt; alert('Failed to fetch listing\'s bids'));
    },
    components: { CommentsView }
}
&lt;/script&gt;

&lt;template&gt;
    &lt;h2&gt;Listing: {{ listing.title }}&lt;/h2&gt;

    &lt;h2 v-if=&quot;listing.status == false&quot; style=&quot;color:red&quot;&gt;Closed&lt;/h2&gt;

    &lt;div&gt;
        &lt;img v-if=&quot;listing.image&quot; class=&quot;listing-image&quot; :src=&quot;listing.image&quot; /&gt;
        &lt;div v-if=&quot;listing.description&quot; class=&quot;listing-desc&quot;&gt;{{ listing.description }}&lt;/div&gt;
    &lt;/div&gt;

    &lt;div style=&quot;margin: 40px 0&quot;&gt;
        &lt;div&gt;&lt;b&gt;Starting Price:&lt;/b&gt; ${{ listing.price }}&lt;/div&gt;

        &lt;br /&gt;

        &lt;template v-if=&quot;bids.length != 0&quot;&gt;
            &lt;div v-if=&quot;bids[bids.length - 1].price&quot; class=&quot;listing-price&quot;&gt;&lt;b&gt;Current Price:&lt;/b&gt; ${{ bids[bids.length - 1].price }}&lt;/div&gt;
            &lt;div v-if=&quot;this.authStore.username == bids[bids.length - 1].user.username&quot;&gt;Your bid is the current bid.&lt;/div&gt;
        &lt;/template&gt;
    &lt;/div&gt;

    &lt;div style=&quot;margin: 40px 0&quot;&gt;
        &lt;h3&gt;Details&lt;/h3&gt;
        &lt;ul&gt;
            &lt;li&gt;Listed by: &lt;b&gt;{{ listing.user.username }}&lt;/b&gt;&lt;/li&gt;
            &lt;li v-if=&quot;listing.category&quot;&gt;Category: {{ listing.category.title }}&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;
    &lt;CommentsView :listing=&quot;listing&quot;/&gt;
&lt;/template&gt;

&lt;style&gt;

.listing-image {
    max-width: 400px;
    max-height: 400px;
}

&lt;/style&gt;
</code></pre>
<h3 id="viewscommentsviewvue">views/CommentsView.vue</h3>
<p>Данное представление реализует постраничный просмотр комментариев под листингом. </p>
<pre><code class="language-js">&lt;script&gt;
import api from '../api'
import router from '../router'
import Comment from '../components/Comment.vue'
import { RouterLink } from 'vue-router'

export default {
    props: ['listing'],
    data() {
        return { post: this.$props.listing, comments: [], currentPage: 0, perPage: 2 }
    },
    methods: {
        newComment() {
            router.push({ path: `/listings/${this.listing.id}/new-comment` })
        },
        prevPage() {
        if (this.currentPage - 1 &gt;= 0) {
            this.currentPage--
            this.fetchComments()
        }
        },
        nextPage() {
            this.currentPage++
            this.fetchComments()
        },
        fetchComments() {
            console.log('fetching ', this.currentPage)
            api
                .get(`api/listing_comments/${this.listing.id}`, {
                    params: { page: this.currentPage, perPage: this.perPage },
                })
                .then((resp) =&gt; resp.data)
                .then((data) =&gt; (this.comments = data))
                .catch((_) =&gt; alert('Failed to fetch comments'))
        },
    },
    beforeMount() {
        this.currentPage = 0
        this.fetchComments()
    },
    components: [Comment],
    components: { Comment, RouterLink },
}
&lt;/script&gt;

&lt;template&gt;
    &lt;h3&gt;Comments&lt;/h3&gt;
    &lt;button v-on:click=&quot;newComment&quot;&gt;New comment&lt;/button&gt;
    &lt;Comment v-for=&quot;comment in comments&quot; :comment=&quot;comment&quot; :key=&quot;comment.id&quot; /&gt;
    &lt;div class=&quot;pagination&quot;&gt;
        &lt;button v-on:click=&quot;prevPage&quot;&gt;&amp;lt; Prev&lt;/button&gt;
        &lt;button v-on:click=&quot;nextPage&quot;&gt;Next &amp;gt;&lt;/button&gt;
    &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h3 id="viewsnewcommentviewvue">views/NewCommentView.vue</h3>
<p>Данное представление отвечает за создание новых комментариев под листингом.</p>
<pre><code class="language-js">&lt;script&gt;
import router from '../router'
import api from '../api'

export default {
    data() {
        return { listingId: this.$route.params.id, content: '' }
    },
    methods: {
        publish() {
        api
            .post('api/comments/', {
                comment: this.content,
                listing_id: this.listingId,
            })
            .then((_) =&gt; router.push({ path: `/listings/${this.listingId}` }))
            .catch((_) =&gt; alert('Failed to create a comment'))
        },
    },
}
&lt;/script&gt;

&lt;template&gt;
    &lt;h2&gt;New comment&lt;/h2&gt;
    &lt;label for=&quot;content&quot;&gt;Content&lt;/label&gt;
    &lt;br /&gt;
    &lt;textarea name=&quot;content&quot; cols=&quot;30&quot; rows=&quot;10&quot; v-model=&quot;content&quot;&gt;&lt;/textarea&gt;
    &lt;br /&gt;&lt;br /&gt;
    &lt;button v-on:click=&quot;publish&quot;&gt;Create&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<h3 id="viewsnewlistingviewvue">views/NewListingView.vue</h3>
<p>Данное представление предназначено для создания новыйх листингов на платформе.</p>
<pre><code class="language-js">&lt;script&gt;
import router from '../router'
import api from '../api'
import { useAuthStore } from '../stores/auth'

export default {
    data() {
        this.authStore = useAuthStore()
        return {
            title: '',
            description: '',
            image: '',
            price: 0,
        }
    },
    methods: {
        publish() {
        api
            .post('api/listings/', {
                title: this.title,
                description: this.description,
                user: this.authStore.userData.username,
                price: this.price,
                image: this.image,
                status: true,
            })
            .then((_) =&gt; router.push({ path: '/listings' }))
            .catch((_) =&gt; alert('Failed to create a listing'))
        },
    },
}
&lt;/script&gt;

&lt;template&gt;
    &lt;h2&gt;Create Listing&lt;/h2&gt;

    &lt;label for=&quot;title&quot;&gt;Title&lt;/label&gt;
    &lt;br /&gt;
    &lt;input type=&quot;text&quot; name=&quot;title&quot; v-model=&quot;title&quot; /&gt;

    &lt;br /&gt;&lt;br /&gt;

    &lt;label for=&quot;description&quot;&gt;Description (optional)&lt;/label&gt;
    &lt;br /&gt;
    &lt;textarea name=&quot;description&quot; cols=&quot;30&quot; rows=&quot;10&quot; v-model=&quot;description&quot;&gt;&lt;/textarea&gt;

    &lt;br /&gt;&lt;br /&gt;

    &lt;label for=&quot;image&quot;&gt;Image URL (optional)&lt;/label&gt;
    &lt;br /&gt;
    &lt;input type=&quot;text&quot; name=&quot;image&quot; v-model=&quot;image&quot; /&gt;

    &lt;br /&gt;&lt;br /&gt;

    &lt;label for=&quot;image&quot;&gt;Starting price $&lt;/label&gt;
    &lt;br /&gt;
    &lt;input type=&quot;number&quot; name=&quot;price&quot; v-model=&quot;price&quot; /&gt;

    &lt;br /&gt;&lt;br /&gt;

    &lt;button v-on:click=&quot;publish&quot;&gt;Create&lt;/button&gt;
&lt;/template&gt;

</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../lab-3/" class="btn btn-neutral float-left" title="Лабораторная работа #3"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../pract-3-1/" class="btn btn-neutral float-right" title="Практическая работа #3.1">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../lab-3/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../pract-3-1/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
